"use strict";var Q=Object.defineProperty;var Te=Object.getOwnPropertyDescriptor;var be=Object.getOwnPropertyNames;var ke=Object.prototype.hasOwnProperty;var ye=(e,t)=>{for(var n in t)Q(e,n,{get:t[n],enumerable:!0})},Ie=(e,t,n,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of be(t))!ke.call(e,o)&&o!==n&&Q(e,o,{get:()=>t[o],enumerable:!(i=Te(t,o))||i.enumerable});return e};var Ee=e=>Ie(Q({},"__esModule",{value:!0}),e);var Ue={};ye(Ue,{activate:()=>Be,deactivate:()=>Re});module.exports=Ee(Ue);var f=require("vscode");var g=require("vscode");var K=require("path"),E=require("vscode");var re=require("path"),v=require("vscode"),G=0;function z(){G=performance.now()}function Ve(){return G!==0?Math.round(performance.now()-G):0}function W(e=!1){let t=Ve();return t=t>1e3?(t/1e3).toFixed(2)+" s":t+" ms",e?`(${t})`:`${t}`}function y(...e){if(!v.workspace.workspaceFolders)return;let t=v.workspace.workspaceFolders[0].uri;return e?v.Uri.file((0,re.join)(t.path,...e.filter(n=>!!n))):t}function X(e,t){let n=e.indexOf(t),i=n>0;return i&&(e.splice(n,1),e.unshift(t)),i}async function ae(e){return new TextDecoder("utf-8").decode(await v.workspace.fs.readFile(e))}function Y(e){e?v.workspace.openTextDocument(e).then(t=>{v.window.showTextDocument(t)},()=>{v.window.showInformationMessage("File not found: "+e?.fsPath)}):v.window.showInformationMessage("File Not found.")}function m(e,t){let n=v.workspace.getConfiguration("livewire-jump");return e?t?n.get(e,t):n.get(e):n}function se(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}var I,le=[];async function pe(e){let t=m("blade.icon.dirs",{});if(t){z(),I=[],le=Object.entries(t).filter(([n,i])=>!!n).map(([n,i])=>De(n,i));for(let n of le)await de(n,"",E.workspace.workspaceFolders[0].uri);await e.workspaceState.update(te(e),I),E.window.showInformationMessage("Icons Refreshed: "+I.length+" icons "+W(!0))}}function ee(e){return I===void 0&&(I=e.workspaceState.get(te(e),[])),I}async function ce(e){I=[],await e.workspaceState.update(te(e),void 0),E.window.showInformationMessage("Icons Cleared")}function te(e){return`${e.extension.id}.blade.icons`}function De(e,t){return{path:e,tag:t}}async function de(e,t,n){if(I===void 0||!e.path||!e.tag)return;let i=[];try{i=await E.workspace.fs.readDirectory(n.with({path:(0,K.join)(n.path,e.path,t)}))}catch{return}for(let[o,a]of i){let s=(0,K.join)(t,o),r=(0,K.join)(e.path,s);a===E.FileType.Directory?de(e,s,n):a===E.FileType.File&&o.endsWith(".svg")&&I.push({path:r,tag:e.tag+s.replace(/\//g,".").replace(/\.svg$/,"")})}}var N=class{constructor(t){this.context=t}linkedIcons=[];getLinkRE(){return/<\/?(x-[a-z0-9][a-z0-9-\.:]*)[\s\/>$]/g}provideCompletionItems(t,n){if(!m("blade.icon.completion",!0))return[];let o=t.lineAt(n).text.slice(0,n.character).match(/<([a-z0-9-\.:]*)$/i);return o?ee(this.context).map(a=>{let s=a.tag??"unknown",r=new g.CompletionItem(s,g.CompletionItemKind.Snippet);return s&&(r.detail="Blade Icon",r.insertText=new g.SnippetString(`${s} $0`),r.documentation=new g.MarkdownString(`Inserts a blade icon: 

\`\`\`html
<${s} />
\`\`\``),o.index&&(r.range=new g.Range(new g.Position(n.line,o.index+1),new g.Position(n.line,n.character)))),r}):[]}provideDocumentLinks(t,n){if(!m("blade.icon.link",!0))return[];this.linkedIcons=[];let i=[],o=100;for(let a=0;a<t.lineCount;a++){if(n.isCancellationRequested)return[];let s=t.lineAt(a),r=this.getLinkRE(),l,u=0;for(;(l=r.exec(s.text))!==null&&u<o;){if(n.isCancellationRequested)return[];if(u++,l){let c=l[1],p=this.linkedIcons.find(S=>S.tag===c);if(!p){if(p=ee(this.context).find(S=>S.tag===c),!p)continue;this.linkedIcons.push(p)}let P=y(p.path);if(!P)continue;let D=l[0],F=l.index+D.indexOf(c),L=new g.Position(s.lineNumber,F),J=new g.Position(s.lineNumber,F+c.length);i.push(new g.DocumentLink(new g.Range(L,J),P)),r.lastIndex===l.index&&r.lastIndex++}}}return i}};var d=require("vscode");var B=require("path"),x=require("vscode");var ue=require("path"),T=require("vscode");var w,A,V=[];function ne(e){V.length===1?Y(V[0].uri):V.length>1&&T.window.showQuickPick(V,{placeHolder:"Choose an option"}).then(t=>{t?.uri&&(A==="php"?(w=w,X(w.aliases,t.label)&&ge(e)):A==="blade"&&(w=w,X(w.phpReferences,t.label)&&me(e)),Y(t.uri))})}function $(){w=void 0,A=void 0,V=[],T.commands.executeCommand("setContext","livewire-jump.hasView",!1),T.commands.executeCommand("setContext","livewire-jump.hasClass",!1)}function U(e,t){if(!m("view.navigation",!0)||($(),!t))return;let n=T.workspace.asRelativePath(t.document.uri.path,!1);t.document.languageId==="blade"||t.document.uri.path.endsWith(".blade.php")?(w=R(e).find(i=>i.bladePath===n),w?.phpReferences&&w.phpReferences.length>0&&(A="blade",w.phpReferences.forEach(i=>{let o=y(i);o&&V.push({label:i,description:"PHP",uri:o})})),V.length>0&&T.commands.executeCommand("setContext","livewire-jump.hasClass",!0)):(t.document.languageId==="php"||t.document.uri.path.endsWith(".php"))&&(w=he(e).find(i=>i.path===n),A="php",w?.aliases.forEach(i=>{let o=R(e).find(a=>a.alias===i);if(o){let a=y(o.bladePath);a&&V.push({label:i,description:"View",uri:a})}}),V.length>0&&T.commands.executeCommand("setContext","livewire-jump.hasView",!0))}function ie(e,t){let n=T.workspace.getWorkspaceFolder(t);if(!n)return;let i;if(e.bladePath)i=e.bladePath;else if(e.phpPath)i=e.phpPath;else return;return T.Uri.file((0,ue.join)(n.uri.path,i))}function fe(e,t,n){let i=j(e).find(o=>o.tag===t);return i?ie(i,n):void 0}async function xe(e){if(!e)return[];let t=/\bview\s*\(\s*[\'"]([a-z0-9\.-]+)[\'"]/g,n=[],i=t.exec(e);for(;i;){let o=i[1];n.includes(o)||n.push(i[1]),i=t.exec(e)}return n}var M=[],C,h,b,H=[];function R(e){return C===void 0&&(C=e.workspaceState.get(O(e),[])),C}function me(e){e.workspaceState.update(O(e),C)}function ge(e){e.workspaceState.update(_(e),b)}function j(e){return h===void 0&&(h=e.workspaceState.get(oe(e),[])),h}function he(e){return b===void 0&&(b=e.workspaceState.get(_(e),[])),b}async function we(e,t){let n=m("view.dirs",{});if(!n)return;z(),M=Object.entries(n).map(([o,a])=>Fe(o,a)),C=[],h=[],b=[];let i=x.workspace.getWorkspaceFolder(t.document.uri);if(i){H=[];for(let o of M)await ve(o,"",i.uri);for(let o of M)await Pe(o,"",i.uri),C!==void 0&&b.forEach(a=>{a.aliases=a.aliases.filter(s=>{let r=!1;return C?.forEach(l=>{l.alias===s&&(l.phpReferences.includes(a.path)||l.phpReferences.push(a.path),r=!0)}),r})}),h!==void 0&&h.forEach(a=>{C?.some(s=>s.alias===a.alias?(a.bladePath=s.bladePath,!0):!1)});if(h===void 0)H=[];else for(;H.length>0;){let o=H.pop();o&&!h.some(a=>a.alias===o.alias)&&h.push(o)}}await e.workspaceState.update(O(e),C),await e.workspaceState.update(oe(e),h),await e.workspaceState.update(_(e),b),x.window.showInformationMessage(`Refreshed Views: ${C.length} views, ${h.length} components, ${b.length} classes `+W(!0)),U(e,t)}async function Ce(e){C=[],h=[],b=[],await e.workspaceState.update(O(e),void 0),await e.workspaceState.update(oe(e),void 0),await e.workspaceState.update(_(e),void 0),$(),x.window.showInformationMessage("Cleared Views")}function Fe(e,t){let n=e.split(/\||:|\s/g),i=t.split(/\||\s/g),o=i[1],a;return o?.startsWith("x-")?a=1:o?.startsWith("livewire:")?a=2:o&&(a=3),{bladePath:n[0],phpPath:n[1],alias:i[0]??"",tag:o,componentType:a}}function O(e){return`${e.extension.id}.views`}function oe(e){return`${e.extension.id}.components`}function _(e){return`${e.extension.id}.phpFiles`}async function Pe(e,t,n){if(b===void 0&&h===void 0||!e.phpPath)return;let i=[];try{i=await x.workspace.fs.readDirectory(n.with({path:(0,B.join)(n.path,e.phpPath,t)}))}catch{return}for(let[o,a]of i){let s=(0,B.join)(t,o),r=(0,B.join)(e.phpPath,s);if(a===x.FileType.Directory&&!M.some(l=>r===l.phpPath))await Pe(e,s,n);else if(a===x.FileType.File&&o.endsWith(".php")){let l=y(r),u=se(s.replace(/\//g,".").replace(/\.php$/,"")),c=l?await xe(await ae(l)):[];if(c.length===0&&c.push(e.alias+u),b!==void 0){let p={aliases:c,path:r};b.push(p)}if(h!==void 0&&e.componentType&&e.tag){let p={phpPath:r,tag:e.tag+Se(u),alias:c[0],type:e.componentType};h.push(p)}}}}function Se(e){let t=e.split(".");if(t.length<2)return e;let n=t.pop(),i=t.join(".");return t[t.length-1]===n?i:e}async function ve(e,t,n){if(C===void 0||!e.bladePath)return;let i=[];try{i=await x.workspace.fs.readDirectory(n.with({path:(0,B.join)(n.path,e.bladePath,t)}))}catch{return}let o=!1,a="";if(e.componentType===1&&(o=!t,!o&&(o=i.some(([s,r])=>r===x.FileType.File&&s==="index.blade.php"),i=i.filter(([s])=>s!=="index.blade.php"),!o))){let r=t.split("/").pop();r&&(r+=".blade.php",o=i.some(([l,u])=>u===x.FileType.File&&l===r),a=r)}for(let[s,r]of i){let l=(0,B.join)(t,s),u=(0,B.join)(e.bladePath,l);if(r===x.FileType.Directory&&!M.some(c=>u===c.bladePath))ve(e,l,n);else if(r===x.FileType.File&&s.endsWith(".blade.php")){let c=l.replace(/\//g,".").replace(/\.blade\.php$/,""),p=e.alias+c,P={bladePath:u,alias:p,phpReferences:[]};if(C.push(P),o&&h!==void 0&&e.componentType&&e.tag){let D={bladePath:u,tag:e.tag+(s===a?c.substring(0,c.length-a.length+9):c),alias:p,type:e.componentType};H.push(D)}}}}var q=class{constructor(t){this.context=t}linkedComponents=[];getLinkRE(){return/<\/?([a-z0-9][a-z0-9-\.:]{3,}[a-z0-9])[\s\/>$]/g}provideCompletionItems(t,n){if(!m("blade.tag.completion",!0))return[];let o=t.lineAt(n).text.slice(0,n.character).match(/<([a-z0-9-\.:]*)$/);return o?j(this.context).map(s=>{let r=new d.CompletionItem(s.tag,d.CompletionItemKind.Snippet);return r.detail="Component",r.insertText=new d.SnippetString(`${s.tag} $0`),r.documentation=new d.MarkdownString(`Inserts a component: 

\`\`\`html
<${s.tag} />
\`\`\``),o.index&&(r.range=new d.Range(new d.Position(n.line,o.index+1),new d.Position(n.line,n.character))),r}):[]}provideDocumentLinks(t,n){if(!m("blade.tag.link",!0))return[];let i=[],o=100;for(let a=0;a<t.lineCount;a++){let s=t.lineAt(a),r=this.getLinkRE(),l,u=0;for(;(l=r.exec(s.text))!==null&&u<o;){if(n.isCancellationRequested)return[];if(u++,l){let c=l[1],p=this.linkedComponents.find(S=>S.tag===c);if(r.lastIndex===l.index&&r.lastIndex++,!p){if(p=j(this.context).find(S=>S.tag===c),!p)continue;this.linkedComponents.push(p)}let P=ie(p,t.uri);if(!P)continue;let D=l[0],F=l.index+D.indexOf(c),L=new d.Position(s.lineNumber,F),J=new d.Position(s.lineNumber,F+c.length);i.push(new d.DocumentLink(new d.Range(L,J),P))}}}return i}provideHover(t,n,i){if(!m("blade.tag.hover",!0))return null;let o=t.lineAt(n.line).text,a,s=this.getLinkRE();for(;(a=s.exec(o))!==null;){if(i.isCancellationRequested)return null;let r=a[1],l=a.index,u=l+r.length;if(n.character>=l&&n.character<=u){let c=new d.Range(new d.Position(n.line,l),new d.Position(n.line,u)),p=fe(this.context,r,t.uri);if(!p)continue;if(p){let P=d.workspace.asRelativePath(p.fsPath);return new d.Hover(`Component: **${r}**

Path: ${P}`,c)}}}return null}};var k=require("vscode");var Z=class e{constructor(t){this.context=t}loadedViews=[];static regex="(?:"+["(?:"+["#\\[Layout","@(?:"+["each","extends","include","includeIf"].join("|")+")","(?:^|[^A-Za-z0-9_:])(?:"+["view","links","layout","withView"].join("|")+")"].join("|")+`)\\(['"]([a-zA-Z0-9\\.-:]*)`].join("|")+")";provideCompletionItems(t,n,i,o){if(m("view.completion",!0)===!1)return[];let a=t.lineAt(n).text,s=RegExp(e.regex+"$").exec(a.slice(0,n.character));if(!s)return[];let r=new k.Position(n.line,s.index+s[0].length-s[1].length),l=new k.Position(n.line,s.index+s[0].length),u=new k.Range(r,l);return(R(this.context)||[]).map(c=>{let p=new k.CompletionItem(`${c.alias}`,k.CompletionItemKind.File);return p.detail="Blade View",p.documentation=`View: ${c.alias}`,p.range=u,p})}provideDocumentLinks(t,n){if(this.loadedViews=[],!m("view.link",!0))return[];let i=[],o=t.getText(),a=100,s=0,r,l=RegExp(e.regex+`['"]`,"g");for(;(r=l.exec(o))!==null&&s<a;){if(n.isCancellationRequested)return[];let u=r[1];if(u){let c=this.findView(u),p=c?y(c.bladePath):void 0;if(p){let P=r.index+r[0].indexOf(u),D=P+u.length,F=t.positionAt(P),L=t.positionAt(D);i.push(new k.DocumentLink(new k.Range(F,L),p))}l.lastIndex===r.index&&l.lastIndex++}s++}return i}provideHover(t,n,i){m("view.hover",!0)}findView(t){let n=this.loadedViews.find(i=>i.alias===t);if(!n){let i=R(this.context).filter(o=>!!o.bladePath).find(o=>o.alias===t);return i&&this.loadedViews.push(i),i}return n}};function Be(e){let t={scheme:"file",language:"blade"},n={scheme:"file",language:"php",pattern:"**/*.blade.php"},i={scheme:"file",language:"php"},o=new q(e),a=new Z(e),s=new N(e);e.subscriptions.push(f.languages.registerCompletionItemProvider([t,n],o,"<"),f.languages.registerDocumentLinkProvider([t,n],o),f.languages.registerHoverProvider([t,n],o),f.languages.registerCompletionItemProvider([t,i],a,"'",'"'),f.languages.registerDocumentLinkProvider([t,i],a),f.commands.registerTextEditorCommand("livewire-jump.refreshViews",r=>{we(e,r)}),f.commands.registerCommand("livewire-jump.goToClass",()=>{ne(e)}),f.commands.registerCommand("livewire-jump.goToView",()=>{ne(e)}),f.commands.registerCommand("livewire-jump.clearViews",async()=>{await Ce(e)}),f.languages.registerCompletionItemProvider([t,n],s,"<"),f.languages.registerDocumentLinkProvider([t,n],s),f.commands.registerCommand("livewire-jump.refreshBladeIcons",async()=>{await pe(e)}),f.commands.registerCommand("livewire-jump.clearBladeIcons",async()=>{await ce(e)}),f.window.onDidChangeActiveTextEditor(r=>{U(e,r)}),f.workspace.onDidChangeConfiguration(r=>{r.affectsConfiguration("livewire-jump.view.navigation")&&(m("view.navigation",!0)?U(e,void 0):$())})),U(e,f.window.activeTextEditor),console.log("Livewire Jump up")}function Re(){}0&&(module.exports={activate,deactivate});
