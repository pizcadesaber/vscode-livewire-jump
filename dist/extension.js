"use strict";var z=Object.defineProperty;var de=Object.getOwnPropertyDescriptor;var he=Object.getOwnPropertyNames;var ue=Object.prototype.hasOwnProperty;var me=(o,e)=>{for(var t in e)z(o,t,{get:e[t],enumerable:!0})},fe=(o,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of he(e))!ue.call(o,i)&&i!==t&&z(o,i,{get:()=>e[i],enumerable:!(n=de(e,i))||n.enumerable});return o};var ge=o=>fe(z({},"__esModule",{value:!0}),o);var Pe={};me(Pe,{activate:()=>ve,deactivate:()=>Ce});module.exports=ge(Pe);var u=require("vscode");var T=require("vscode");var S=require("path"),f=require("vscode");var J=require("path"),w=require("vscode"),K=0;function D(){K=performance.now()}function we(){return K!==0?Math.round(performance.now()-K):0}function V(o=!1){let e=we();return e=e>1e3?(e/1e3).toFixed(2)+" s":e+" ms",o?`(${e})`:`${e}`}function b(...o){if(!w.workspace.workspaceFolders)return;let e=w.workspace.workspaceFolders[0].uri;return o?w.Uri.file((0,J.join)(e.path,...o.filter(t=>!!t))):e}function N(o,e){let t=o.indexOf(e),n=t>0;return n&&(o.splice(t,1),o.unshift(e)),n}async function Q(o){return w.workspace.fs.readFile(o).then(e=>Buffer.from(e).toString("utf8"))}function q(o){o?w.workspace.openTextDocument(o).then(e=>{w.window.showTextDocument(e)},()=>{w.window.showInformationMessage("File not found: "+o?.fsPath)}):w.window.showInformationMessage("File Not found.")}function m(o,e){let t=w.workspace.getConfiguration("livewire-jump");return o?e?t.get(o,e):t.get(o):t}function R(o){return o.replace(/([a-z])([A-Z])/g,"$1-$2").replace("_","-").toLowerCase()}function X(o,e){return`${o.extension.id}.${e}`}var I,O=0,ee=[];async function Z(o){let e=m("blade.icon.dirs",{});if(e){D(),I=[],O=0,ee=Object.entries(e).filter(([t,n])=>!!t).map(([t,n])=>xe(t,n));for(let t of ee)if(t.group){let n=b(t.path);if(n){let i=await ae(t.group,n);i&&I.push(i)}}await o.workspaceState.update(Y(o),I),f.window.showInformationMessage("Icons Refreshed: "+O+" icons "+V(!0))}}function te(o){if(I===void 0)try{I=o.workspaceState.get(Y(o),[])}catch{return f.window.showInformationMessage("Upgrading icons..."),Z(o),[]}return I}async function ne(o){I=[],await o.workspaceState.update(Y(o),void 0),f.window.showInformationMessage("Icons Cleared")}function ie(o,e){return oe(te(o),[],"",e)}function oe(o,e,t,n){let i=[];return o.forEach(r=>{i.push(...oe(r.groups,r.icons,t+r.tag,n))}),e.forEach(r=>{let s=t+r.tag,a=new f.CompletionItem(s,f.CompletionItemKind.Snippet);a.detail="Blade Icon",a.insertText=new f.SnippetString(`${s} $0`),a.documentation=new f.MarkdownString(`Inserts a blade icon: 

\`\`\`html
<${s} />
\`\`\``),a.range=n,i.push(a)}),i}function re(o,e){let t=te(o);if(t.length===0)return;let n=b();return n?se(t,[],n,e):void 0}function se(o,e,t,n){for(let i of o)if(n.startsWith(i.tag))return se(i.groups,i.icons,t.with({path:(0,S.join)(t.path,i.path)}),n.substring(i.tag.length));for(let i of e)if(i.tag===n)return{...i,uri:t.with({path:(0,S.join)(t.path,i.name)})}}function Y(o){return X(o,"blade.icons")}function xe(o,e){return{path:o,tag:e,group:o&&e?{path:o,tag:e,groups:[],icons:[]}:void 0}}async function ae(o,e){let t=[];try{t=await f.workspace.fs.readDirectory(e)}catch{return}for(let[n,i]of t)if(i===f.FileType.Directory){let r=await ae({path:n,tag:R(n)+".",groups:[],icons:[]},e.with({path:(0,S.join)(e.path,n)}));r&&o.groups.push(r)}else i===f.FileType.File&&n.endsWith(".svg")&&(O+=1,o.icons.push({name:n,tag:R(n.replace(/\.svg$/,""))}));return o.groups.length>0||o.icons.length>0?o:void 0}var $=class{constructor(e){this.D=e}y=[];f(){return/<\/?(x-[a-z0-9][a-z0-9-\.:]*)[\s\/>$]/g}provideCompletionItems(e,t){if(!m("blade.icon.completion",!0))return[];let i=e.lineAt(t).text.slice(0,t.character).match(/<([a-z0-9-\.:]*)$/i);if(!i)return[];let r=new T.Range(new T.Position(t.line,i.index+1),new T.Position(t.line,t.character));return ie(this.D,r)}provideDocumentLinks(e,t){if(!m("blade.icon.link",!0))return[];this.y=[];let n=[],i=100;for(let r=0;r<e.lineCount;r++){if(t.isCancellationRequested)return[];let s=e.lineAt(r),a=this.f(),l,p=0;for(;(l=a.exec(s.text))!==null&&p<i;){if(t.isCancellationRequested)return[];if(p++,l){let d=l[1],c=this.y.find(H=>H.tag===d);if(!c){if(c=re(this.D,d),!c)continue;this.y.push(c)}if(!c.uri)continue;let g=l[0],P=l.index+g.indexOf(d),y=new T.Position(s.lineNumber,P),B=new T.Position(s.lineNumber,P+d.length);n.push(new T.DocumentLink(new T.Range(y,B),c.uri)),a.lastIndex===l.index&&a.lastIndex++}}}return n}};var h=require("vscode");var U=class{constructor(e,t){this.t=e;this.g=t}I=[];f(){return/<\/?([a-z0-9][a-z0-9-\.:]{3,}[a-z0-9])[\s\/>$]/g}provideCompletionItems(e,t){if(!m("blade.tag.completion",!0))return[];this.I=[];let i=e.lineAt(t).text.slice(0,t.character).match(/<([a-z0-9-\.:]*)$/);return i?this.t.l().map(s=>{let a=new h.CompletionItem(s.tag,h.CompletionItemKind.Snippet);return a.detail="Component",a.insertText=new h.SnippetString(`${s.tag} $0`),a.documentation=new h.MarkdownString(`Inserts a component: 

\`\`\`html
<${s.tag} />
\`\`\``),i.index&&(a.range=new h.Range(new h.Position(t.line,i.index+1),new h.Position(t.line,t.character))),a}):[]}provideDocumentLinks(e,t){if(!m("blade.tag.link",!0))return[];let n=[],i=100;for(let r=0;r<e.lineCount;r++){let s=e.lineAt(r),a=this.f(),l,p=0;for(;(l=a.exec(s.text))!==null&&p<i;){if(t.isCancellationRequested)return[];if(p++,l){let d=l[1],c=this.I.find(_=>_.tag===d);if(a.lastIndex===l.index&&a.lastIndex++,!c){if(c=this.t.l().find(_=>_.tag===d),!c)continue;this.I.push(c)}let g=this.g.h(c,e.uri);if(!g)continue;let P=l[0],y=l.index+P.indexOf(d),B=new h.Position(s.lineNumber,y),H=new h.Position(s.lineNumber,y+d.length);n.push(new h.DocumentLink(new h.Range(B,H),g))}}}return n}provideHover(e,t,n){if(!m("blade.tag.hover",!0))return null;let i=e.lineAt(t.line).text,r,s=this.f();for(;(r=s.exec(i))!==null;){if(n.isCancellationRequested)return null;let a=r[1],l=r.index,p=l+a.length;if(t.character>=l&&t.character<=p){let d=new h.Range(new h.Position(t.line,l),new h.Position(t.line,p)),c=this.g.j(a,e.uri);if(!c)continue;if(c){let g=h.workspace.asRelativePath(c.fsPath);return new h.Hover(`Component: **${a}**

*${g}*`,d)}}}return null}};var x=require("vscode");var A=class o{constructor(e){this.t=e}k=[];static S="(?:"+["(?:"+["#\\[Layout","@(?:"+["each","extends","include","includeIf"].join("|")+")","(?:^|[^A-Za-z0-9_:])(?:"+["view","links","layout","withView"].join("|")+")"].join("|")+`)\\(['"]([a-zA-Z0-9\\.-:]*)`].join("|")+")";provideCompletionItems(e,t,n,i){if(m("view.completion",!0)===!1)return[];let r=e.lineAt(t).text,s=RegExp(o.S+"$").exec(r.slice(0,t.character));if(!s)return[];let a=new x.Position(t.line,s.index+s[0].length-s[1].length),l=new x.Position(t.line,s.index+s[0].length),p=new x.Range(a,l);return(this.t.u()||[]).map(d=>{let c=new x.CompletionItem(`${d.name}`,x.CompletionItemKind.File);return c.detail="Blade View",c.documentation=`View: ${d.name}`,c.range=p,c})}provideDocumentLinks(e,t){if(!m("view.link",!0))return[];this.k=[];let n=[],i=e.getText(),r=100,s=0,a,l=RegExp(o.S+`['"]`,"g");for(;(a=l.exec(i))!==null&&s<r;){if(t.isCancellationRequested)return[];let p=a[1];if(p){let d=this.findView(p),c=d?b(d.bladePath):void 0;if(c){let g=a.index+a[0].indexOf(p),P=g+p.length,y=e.positionAt(g),B=e.positionAt(P);n.push(new x.DocumentLink(new x.Range(y,B),c))}l.lastIndex===a.index&&l.lastIndex++}s++}return n}provideHover(e,t,n){m("view.hover",!0)}findView(e){let t=this.k.find(n=>n.name===e);if(!t){let n=this.t.u().filter(i=>!!i.bladePath).find(i=>i.name===e);return n&&this.k.push(n),n}return t}};var E=require("vscode");var k=require("path"),C=require("vscode");async function le(o){if(!o)return[];let e=/\bview\s*\(\s*[\'"]([a-z0-9\.-]+)[\'"]/g,t=[],n=e.exec(o);for(;n;){let i=n[1];t.includes(i)||t.push(n[1]),n=e.exec(o)}return t}var F=class{a=[];r=[];c=[];w=[];M=!1;m=[];async discover(e){if(this.M){console.warn("Blade view discovery is finished");return}let t=m("view.dirs",{});if(!t)return;D(),this.m=Object.entries(t).map(([i,r])=>this.createDirFromSetting(i,r)),this.a=[],this.r=[],this.c=[];let n=C.workspace.getWorkspaceFolder(e.document.uri);if(n){this.w=[];for(let i of this.m)await this.$(i,"",n.uri);for(let i of this.m)await this.U(i,"",n.uri),this.c.forEach(r=>{r.aliases=r.aliases.filter(s=>{let a=!1;return this.a.forEach(l=>{l.name===s&&(l.phpReferences.includes(r.path)||l.phpReferences.push(r.path),a=!0)}),a})}),this.r.forEach(r=>{this.a.some(s=>s.name===r.alias?(r.bladePath=s.bladePath,!0):!1)});for(;this.w.length>0;){let i=this.w.pop();i&&!this.r.some(r=>r.alias===i.alias)&&this.r.push(i)}return{a:this.a,r:this.r,c:this.c}}}createDirFromSetting(e,t){let n=e.split(/\||:|\s/g),i=t.split(/\||\s/g),r=i[1],s;return r?.startsWith("x-")?s=1:r?.startsWith("livewire:")?s=2:r&&(s=3),{bladePath:n[0],phpPath:n[1],alias:i[0]??"",tag:r,componentType:s}}async U(e,t,n){if(!e.phpPath)return;let i=[];try{i=await C.workspace.fs.readDirectory(n.with({path:(0,k.join)(n.path,e.phpPath,t)}))}catch{return}for(let[r,s]of i){let a=(0,k.join)(t,r),l=(0,k.join)(e.phpPath,a);if(s===C.FileType.Directory&&!this.m.some(p=>l===p.phpPath))await this.U(e,a,n);else if(s===C.FileType.File&&r.endsWith(".php")){let p=b(l),d=R(a.replace(/\//g,".").replace(/\.php$/,"")),c=p?await le(await Q(p)):[];c.length===0&&c.push(e.alias+d);let g={aliases:c,path:l};if(this.c.push(g),e.componentType&&e.tag){let P={phpPath:l,tag:e.tag+this.simplifyTag(d),alias:c[0],type:e.componentType};this.r.push(P)}}}}async $(e,t,n){if(this.a===void 0||!e.bladePath)return;let i=[];try{i=await C.workspace.fs.readDirectory(n.with({path:(0,k.join)(n.path,e.bladePath,t)}))}catch{return}let r=!1,s="";if(e.componentType===1&&(r=!t,!r&&(r=i.some(([a,l])=>l===C.FileType.File&&a==="index.blade.php"),i=i.filter(([a])=>a!=="index.blade.php"),!r))){let l=t.split("/").pop();l&&(l+=".blade.php",r=i.some(([p,d])=>d===C.FileType.File&&p===l),s=l)}for(let[a,l]of i){let p=(0,k.join)(t,a),d=(0,k.join)(e.bladePath,p);if(l===C.FileType.Directory&&!this.m.some(c=>d===c.bladePath))this.$(e,p,n);else if(l===C.FileType.File&&a.endsWith(".blade.php")){let c=p.replace(/\//g,".").replace(/\.blade\.php$/,""),g=e.alias+c,P={bladePath:d,name:g,phpReferences:[]};if(this.a.push(P),r&&this.r!==void 0&&e.componentType&&e.tag){let y={bladePath:d,tag:e.tag+(a===s?c.substring(0,c.length-s.length+9):c),alias:g,type:e.componentType};this.w.push(y)}}}}simplifyTag(e){let t=e.split(".");if(t.length<2)return e;let n=t.pop(),i=t.join(".");return t[t.length-1]===n?i:e}};var L=class{constructor(e){this.i=e}n={x:"views",v:"components",C:{P:"phpFiles"}};V=!1;u(){return this.i.B(this.n.x,[])}l(){return this.i.B(this.n.v,[])}A(){return this.i.B(this.n.C.P,[])}async W(e){if(!this.V)return console.info("Refreshing Blade views..."),this.V=!0,new F().discover(e).then(t=>{if(t){let{a:n,r:i,c:r}=t;this.i.o(this.n.x,n),this.i.o(this.n.v,i),this.i.o(this.n.C.P,r),E.window.showInformationMessage(`Refreshed Views: ${n.length} views, ${i.length} components, ${r.length} classes ${V(!0)}`)}else this.i.o(this.n.x,[]),this.i.o(this.n.v,[]),this.i.o(this.n.C.P,[]),E.window.showWarningMessage(`Empty result ${V(!0)}`)}).catch(t=>{E.window.showErrorMessage(`Blade View Refresh Error: ${t} ${V(!0)}`)}).finally(()=>{this.V=!1})}async G(){return Promise.all([this.i.o(this.n.x,void 0),this.i.o(this.n.v,void 0),this.i.o(this.n.C.P,void 0)]).then(()=>{E.window.showInformationMessage("Cleared Views")})}};var M=require("vscode"),j=class{b;T;F;constructor(e){this.b=e.workspaceState,this.T=e.globalState,this.F=e.extension.id}p(e){return`${this.F}.${e}`}K(e,t){return this.T.get(this.p(e),t)}N(e,t){return this.T.update(this.p(e),t)}q(){return Promise.all(this.T.keys().filter(e=>e.startsWith(this.p(""))).map(e=>this.o(e,void 0)))}B(e,t){return this.b.get(this.p(e),t)}o(e,t){return this.b.update(this.p(e),t)}async H(){return Promise.all(this.b.keys().filter(e=>e.startsWith(this.p(""))).map(e=>this.o(e,void 0))).then(()=>M.window.showInformationMessage("All indexed elements have been cleared. You need to reload the extension to reset the elements in memory.","Reload").then(e=>{e==="Reload"&&M.commands.executeCommand("workbench.action.reloadWindow")}))}};var ce=require("vscode"),W=class{constructor(e,t){this.t=e;this.g=t}_(){let e=this.t.u()[0],t=this.t.l()[0],n=this.t.A()[0];return ce.window.showInformationMessage([this.g.z(),`View: ${e.name} - ${e.bladePath};`,`Php Script: ${n.path};`,`Component: ${t.tag} - ${t.bladePath} - ${t.phpPath};`].join(`

`))}};var pe=require("path"),v=require("vscode");var G=class{constructor(e){this.t=e}e=void 0;d=void 0;s=[];z(){return this.e?"bladePath"in this.e?`Target: ${this.e.bladePath};`:"path"in this.e?`Target: ${this.e.path};`:`Target: ${this.d};`:"Target: undefined;"}L(){this.s.length===1?q(this.s[0].uri):this.s.length>1&&v.window.showQuickPick(this.s,{placeHolder:"Choose an option"}).then(e=>{e?.uri&&(this.d==="php"?(this.e=this.e,N(this.e.aliases,e.label)):this.d==="blade"&&(this.e=this.e,N(this.e.phpReferences,e.label)),q(e.uri))})}R(){this.e=void 0,this.d=void 0,this.s=[],v.commands.executeCommand("setContext","livewire-jump.hasView",!1),v.commands.executeCommand("setContext","livewire-jump.hasClass",!1)}E(e){if(!m("view.navigation",!0)||(this.R(),!e))return;let t=v.workspace.asRelativePath(e.document.uri.path,!1);e.document.languageId==="blade"||e.document.uri.path.endsWith(".blade.php")?(this.e=this.t.u().find(n=>n.bladePath===t),this.e?.phpReferences&&this.e.phpReferences.length>0&&(this.d="blade",this.e.phpReferences.forEach(n=>{let i=b(n);i&&this.s.push({label:n,description:"PHP",uri:i})})),this.s.length>0&&v.commands.executeCommand("setContext","livewire-jump.hasClass",!0)):(e.document.languageId==="php"||e.document.uri.path.endsWith(".php"))&&(this.e=this.t.A().find(n=>n.path===t),this.d="php",this.e?.aliases.forEach(n=>{let i=this.t.u().find(r=>r.name===n);if(i){let r=b(i.bladePath);r&&this.s.push({label:n,description:"View",uri:r})}}),this.s.length>0&&v.commands.executeCommand("setContext","livewire-jump.hasView",!0))}h(e,t){let n=v.workspace.getWorkspaceFolder(t);if(!n)return;let i;if(e.bladePath)i=e.bladePath;else if(e.phpPath)i=e.phpPath;else return;return v.Uri.file((0,pe.join)(n.uri.path,i))}j(e,t){let n=this.t.l().find(i=>i.tag===e);return n?this.h(n,t):void 0}O(e,t){let n=this.t.l().find(i=>i.alias===e);return n?this.h(n,t):void 0}Z(e,t){let n=this.t.l().find(i=>i.phpPath===e);return n?this.h(n,t):void 0}Y(e,t){let n=this.t.l().find(i=>i.bladePath===e);return n?this.h(n,t):void 0}};function ve(o){let e=new j(o),t=new L(e),n=new G(t),i=new W(t,n),r={scheme:"file",language:"blade"},s={scheme:"file",language:"php",pattern:"**/*.blade.php"},a={scheme:"file",language:"php"},l=new U(t,n),p=new A(t),d=new $(o);o.subscriptions.push(u.commands.registerCommand("livewire-jump.clearIndexedItems",async()=>e.H()),u.languages.registerCompletionItemProvider([r,s],l,"<"),u.languages.registerDocumentLinkProvider([r,s],l),u.languages.registerHoverProvider([r,s],l),u.languages.registerCompletionItemProvider([r,a],p,"'",'"'),u.languages.registerDocumentLinkProvider([r,a],p),u.commands.registerTextEditorCommand("livewire-jump.refreshViews",c=>{t.W(c)}),u.commands.registerCommand("livewire-jump.goToClass",()=>{n.L()}),u.commands.registerCommand("livewire-jump.goToView",()=>{n.L()}),u.commands.registerCommand("livewire-jump.clearViews",async()=>t.G().then(()=>n.R())),u.commands.registerCommand("livewire-jump.status",async()=>i._()),u.languages.registerCompletionItemProvider([r,s],d,"<"),u.languages.registerDocumentLinkProvider([r,s],d),u.commands.registerCommand("livewire-jump.refreshBladeIcons",async()=>Z(o)),u.commands.registerCommand("livewire-jump.clearBladeIcons",async()=>ne(o)),u.window.onDidChangeActiveTextEditor(c=>{n.E(c)}),u.workspace.onDidChangeConfiguration(c=>{c.affectsConfiguration("livewire-jump.view.navigation")&&(m("view.navigation",!0)?n.E(void 0):n.R())})),n.E(u.window.activeTextEditor),console.log("Livewire Jump up")}function Ce(){}0&&(module.exports={activate,deactivate});
