"use strict";var Z=Object.defineProperty;var Pe=Object.getOwnPropertyDescriptor;var ve=Object.getOwnPropertyNames;var Te=Object.prototype.hasOwnProperty;var be=(e,t)=>{for(var n in t)Z(e,n,{get:t[n],enumerable:!0})},ke=(e,t,n,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of ve(t))!Te.call(e,o)&&o!==n&&Z(e,o,{get:()=>t[o],enumerable:!(i=Pe(t,o))||i.enumerable});return e};var ye=e=>ke(Z({},"__esModule",{value:!0}),e);var Fe={};be(Fe,{activate:()=>Ve,deactivate:()=>De});module.exports=ye(Fe);var f=require("vscode");var g=require("vscode");var M=require("path"),V=require("vscode");var ne=require("path"),v=require("vscode");function y(...e){if(!v.workspace.workspaceFolders)return;let t=v.workspace.workspaceFolders[0].uri;return e?v.Uri.file((0,ne.join)(t.path,...e.filter(n=>!!n))):t}function J(e,t){let n=e.indexOf(t),i=n>0;return i&&(e.splice(n,1),e.unshift(t)),i}async function ie(e){return new TextDecoder("utf-8").decode(await v.workspace.fs.readFile(e))}function Q(e){e?v.workspace.openTextDocument(e).then(t=>{v.window.showTextDocument(t)},()=>{v.window.showInformationMessage("File not found: "+e?.fsPath)}):v.window.showInformationMessage("File Not found.")}function m(e,t){let n=v.workspace.getConfiguration("livewire-jump");return e?t?n.get(e,t):n.get(e):n}function oe(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}var I,re=[];async function ae(e){let t=m("blade.icon.dirs",{});if(t){I=[],re=Object.entries(t).filter(([n,i])=>!!n).map(([n,i])=>Ie(n,i));for(let n of re)await le(n,"",V.workspace.workspaceFolders[0].uri);await e.workspaceState.update(X(e),I),V.window.showInformationMessage("Refreshed Icons: "+I.length+" icons.")}}function G(e){return I===void 0&&(I=e.workspaceState.get(X(e),[])),I}async function se(e){I=[],await e.workspaceState.update(X(e),void 0)}function X(e){return`${e.extension.id}.blade.icons`}function Ie(e,t){return{path:e,tag:t}}async function le(e,t,n){if(I===void 0||!e.path||!e.tag)return;let i=[];try{i=await V.workspace.fs.readDirectory(n.with({path:(0,M.join)(n.path,e.path,t)}))}catch{return}for(let[o,r]of i){let s=(0,M.join)(t,o),a=(0,M.join)(e.path,s);r===V.FileType.Directory?le(e,s,n):r===V.FileType.File&&o.endsWith(".svg")&&I.push({path:a,tag:e.tag+s.replace(/\//g,".").replace(/\.svg$/,"")})}}var W=class{constructor(t){this.context=t}linkedIcons=[];getLinkRE(){return/<\/?(x-[a-z0-9][a-z0-9-\.:]*)[\s\/>$]/g}provideCompletionItems(t,n){if(!m("blade.icon.completion",!0))return[];let o=t.lineAt(n).text.slice(0,n.character).match(/<([a-z0-9-\.:]*)$/i);return o?G(this.context).map(r=>{let s=r.tag??"unknown",a=new g.CompletionItem(s,g.CompletionItemKind.Snippet);return s&&(a.detail="Blade Icon",a.insertText=new g.SnippetString(`${s} $0`),a.documentation=new g.MarkdownString(`Inserts a blade icon: 

\`\`\`html
<${s} />
\`\`\``),o.index&&(a.range=new g.Range(new g.Position(n.line,o.index+1),new g.Position(n.line,n.character)))),a}):[]}provideDocumentLinks(t,n){if(!m("blade.icon.link",!0))return[];this.linkedIcons=[];let i=[],o=100;for(let r=0;r<t.lineCount;r++){if(n.isCancellationRequested)return[];let s=t.lineAt(r),a=this.getLinkRE(),l,u=0;for(;(l=a.exec(s.text))!==null&&u<o;){if(n.isCancellationRequested)return[];if(u++,l){let c=l[1],p=this.linkedIcons.find(F=>F.tag===c);if(!p){if(p=G(this.context).find(F=>F.tag===c),!p)continue;this.linkedIcons.push(p)}let P=y(p.path);if(!P)continue;let B=l[0],D=l.index+B.indexOf(c),L=new g.Position(s.lineNumber,D),q=new g.Position(s.lineNumber,D+c.length);i.push(new g.DocumentLink(new g.Range(L,q),P)),a.lastIndex===l.index&&a.lastIndex++}}}return i}};var d=require("vscode");var S=require("path"),C=require("vscode");var pe=require("path"),T=require("vscode");var x,$,E=[];function Y(e){E.length===1?Q(E[0].uri):E.length>1&&T.window.showQuickPick(E,{placeHolder:"Choose an option"}).then(t=>{t?.uri&&($==="php"?(x=x,J(x.aliases,t.label)&&ue(e)):$==="blade"&&(x=x,J(x.phpReferences,t.label)&&de(e)),Q(t.uri))})}function A(){x=void 0,$=void 0,E=[],T.commands.executeCommand("setContext","livewire-jump.hasView",!1),T.commands.executeCommand("setContext","livewire-jump.hasClass",!1)}function U(e,t){if(!m("view.navigation",!0)||(A(),!t))return;let n=T.workspace.asRelativePath(t.document.uri.path,!1);t.document.languageId==="blade"||t.document.uri.path.endsWith(".blade.php")?(x=R(e).find(i=>i.bladePath===n),x?.phpReferences&&x.phpReferences.length>0&&($="blade",x.phpReferences.forEach(i=>{let o=y(i);o&&E.push({label:i,description:"PHP",uri:o})})),E.length>0&&T.commands.executeCommand("setContext","livewire-jump.hasClass",!0)):(t.document.languageId==="php"||t.document.uri.path.endsWith(".php"))&&(x=fe(e).find(i=>i.path===n),$="php",x?.aliases.forEach(i=>{let o=R(e).find(r=>r.alias===i);if(o){let r=y(o.bladePath);r&&E.push({label:i,description:"View",uri:r})}}),E.length>0&&T.commands.executeCommand("setContext","livewire-jump.hasView",!0))}function ee(e,t){let n=T.workspace.getWorkspaceFolder(t);if(!n)return;let i;if(e.bladePath)i=e.bladePath;else if(e.phpPath)i=e.phpPath;else return;return T.Uri.file((0,pe.join)(n.uri.path,i))}function ce(e,t,n){let i=j(e).find(o=>o.tag===t);return i?ee(i,n):void 0}async function me(e){if(!e)return[];let t=/\bview\s*\(\s*[\'"]([a-z0-9\.-]+)[\'"]/g,n=[],i=t.exec(e);for(;i;){let o=i[1];n.includes(o)||n.push(i[1]),i=t.exec(e)}return n}var H=[],w,h,b,z=[];function R(e){return w===void 0&&(w=e.workspaceState.get(K(e),[])),w}function de(e){e.workspaceState.update(K(e),w)}function ue(e){e.workspaceState.update(O(e),b)}function j(e){return h===void 0&&(h=e.workspaceState.get(te(e),[])),h}function fe(e){return b===void 0&&(b=e.workspaceState.get(O(e),[])),b}async function ge(e,t){let n=m("view.dirs",{});if(!n)return;H=Object.entries(n).map(([o,r])=>Ee(o,r)),w=[],h=[],b=[];let i=C.workspace.getWorkspaceFolder(t.document.uri);if(i){z=[];for(let o of H)await Ce(o,"",i.uri);for(let o of H)await xe(o,"",i.uri),w!==void 0&&b.forEach(r=>{r.aliases=r.aliases.filter(s=>{let a=!1;return w?.forEach(l=>{l.alias===s&&(l.phpReferences.includes(r.path)||l.phpReferences.push(r.path),a=!0)}),a})}),h!==void 0&&h.forEach(r=>{w?.some(s=>s.alias===r.alias?(r.bladePath=s.bladePath,!0):!1)});if(h===void 0)z=[];else for(;z.length>0;){let o=z.pop();o&&!h.some(r=>r.alias===o.alias)&&h.push(o)}}await e.workspaceState.update(K(e),w),await e.workspaceState.update(te(e),h),await e.workspaceState.update(O(e),b),C.window.showInformationMessage(`Refreshed Views: ${w.length} views, ${h.length} components, ${b.length} classes`),U(e,t)}async function he(e){w=[],h=[],b=[],await e.workspaceState.update(K(e),void 0),await e.workspaceState.update(te(e),void 0),await e.workspaceState.update(O(e),void 0),A(),C.window.showInformationMessage("Cleared Views")}function Ee(e,t){let n=e.split(/\||:|\s/g),i=t.split(/\||\s/g),o=i[1],r;return o?.startsWith("x-")?r=1:o?.startsWith("livewire:")?r=2:o&&(r=3),{bladePath:n[0],phpPath:n[1],alias:i[0]??"",tag:o,componentType:r}}function K(e){return`${e.extension.id}.views`}function te(e){return`${e.extension.id}.components`}function O(e){return`${e.extension.id}.phpFiles`}async function xe(e,t,n){if(b===void 0&&h===void 0||!e.phpPath)return;let i=[];try{i=await C.workspace.fs.readDirectory(n.with({path:(0,S.join)(n.path,e.phpPath,t)}))}catch{return}for(let[o,r]of i){let s=(0,S.join)(t,o),a=(0,S.join)(e.phpPath,s);if(r===C.FileType.Directory&&!H.some(l=>a===l.phpPath))await xe(e,s,n);else if(r===C.FileType.File&&o.endsWith(".php")){let l=y(a),u=oe(s.replace(/\//g,".").replace(/\.php$/,"")),c=l?await me(await ie(l)):[];if(c.length===0&&c.push(e.alias+u),b!==void 0){let p={aliases:c,path:a};b.push(p)}if(h!==void 0&&e.componentType&&e.tag){let p={phpPath:a,tag:e.tag+we(u),alias:c[0],type:e.componentType};h.push(p)}}}}function we(e){let t=e.split(".");if(t.length<2)return e;let n=t.pop(),i=t.join(".");return t[t.length-1]===n?i:e}async function Ce(e,t,n){if(w===void 0||!e.bladePath)return;let i=[];try{i=await C.workspace.fs.readDirectory(n.with({path:(0,S.join)(n.path,e.bladePath,t)}))}catch{return}let o=!1;e.componentType===1&&(o=!t,o||(o=i.some(([r,s])=>s===C.FileType.File&&r==="index.blade.php"),i=i.filter(([r])=>r!=="index.blade.php")));for(let[r,s]of i){let a=(0,S.join)(t,r),l=(0,S.join)(e.bladePath,a);if(s===C.FileType.Directory&&!H.some(u=>l===u.bladePath))Ce(e,a,n);else if(s===C.FileType.File&&r.endsWith(".blade.php")){let u=a.replace(/\//g,".").replace(/\.blade\.php$/,""),c=e.alias+u,p={bladePath:l,alias:c,phpReferences:[]};if(w.push(p),o&&h!==void 0&&e.componentType&&e.tag){let P={bladePath:l,tag:e.tag+we(u),alias:c,type:e.componentType};z.push(P)}}}}var N=class{constructor(t){this.context=t}linkedComponents=[];getLinkRE(){return/<\/?([a-z0-9][a-z0-9-\.:]{3,}[a-z0-9])[\s\/>$]/g}provideCompletionItems(t,n){if(!m("blade.tag.completion",!0))return[];let o=t.lineAt(n).text.slice(0,n.character).match(/<([a-z0-9-\.:]*)$/);return o?j(this.context).map(s=>{let a=new d.CompletionItem(s.tag,d.CompletionItemKind.Snippet);return a.detail="Component",a.insertText=new d.SnippetString(`${s.tag} $0`),a.documentation=new d.MarkdownString(`Inserts a component: 

\`\`\`html
<${s.tag} />
\`\`\``),o.index&&(a.range=new d.Range(new d.Position(n.line,o.index+1),new d.Position(n.line,n.character))),a}):[]}provideDocumentLinks(t,n){if(!m("blade.tag.link",!0))return[];let i=[],o=100;for(let r=0;r<t.lineCount;r++){let s=t.lineAt(r),a=this.getLinkRE(),l,u=0;for(;(l=a.exec(s.text))!==null&&u<o;){if(n.isCancellationRequested)return[];if(u++,l){let c=l[1],p=this.linkedComponents.find(F=>F.tag===c);if(a.lastIndex===l.index&&a.lastIndex++,!p){if(p=j(this.context).find(F=>F.tag===c),!p)continue;this.linkedComponents.push(p)}let P=ee(p,t.uri);if(!P)continue;let B=l[0],D=l.index+B.indexOf(c),L=new d.Position(s.lineNumber,D),q=new d.Position(s.lineNumber,D+c.length);i.push(new d.DocumentLink(new d.Range(L,q),P))}}}return i}provideHover(t,n,i){if(!m("blade.tag.hover",!0))return null;let o=t.lineAt(n.line).text,r,s=this.getLinkRE();for(;(r=s.exec(o))!==null;){if(i.isCancellationRequested)return null;let a=r[1],l=r.index,u=l+a.length;if(n.character>=l&&n.character<=u){let c=new d.Range(new d.Position(n.line,l),new d.Position(n.line,u)),p=ce(this.context,a,t.uri);if(!p)continue;if(p){let P=d.workspace.asRelativePath(p.fsPath);return new d.Hover(`Component: **${a}**

Path: ${P}`,c)}}}return null}};var k=require("vscode");var _=class e{constructor(t){this.context=t}loadedViews=[];static regex="(?:"+["(?:"+["#\\[Layout","@(?:"+["each","extends","include","includeIf"].join("|")+")","(?:^|[^A-Za-z0-9_:])(?:"+["view","links","layout","withView"].join("|")+")"].join("|")+`)\\(['"]([a-zA-Z0-9\\.-:]*)`].join("|")+")";provideCompletionItems(t,n,i,o){if(m("view.completion",!0)===!1)return[];let r=t.lineAt(n).text,s=RegExp(e.regex+"$").exec(r.slice(0,n.character));if(!s)return[];let a=new k.Position(n.line,s.index+s[0].length-s[1].length),l=new k.Position(n.line,s.index+s[0].length),u=new k.Range(a,l);return(R(this.context)||[]).map(c=>{let p=new k.CompletionItem(`${c.alias}`,k.CompletionItemKind.File);return p.detail="Blade View",p.documentation=`View: ${c.alias}`,p.range=u,p})}provideDocumentLinks(t,n){if(this.loadedViews=[],!m("view.link",!0))return[];let i=[],o=t.getText(),r=100,s=0,a,l=RegExp(e.regex+`['"]`,"g");for(;(a=l.exec(o))!==null&&s<r;){if(n.isCancellationRequested)return[];let u=a[1];if(u){let c=this.findView(u),p=c?y(c.bladePath):void 0;if(p){let P=a.index+a[0].indexOf(u),B=P+u.length,D=t.positionAt(P),L=t.positionAt(B);i.push(new k.DocumentLink(new k.Range(D,L),p))}l.lastIndex===a.index&&l.lastIndex++}s++}return i}provideHover(t,n,i){m("view.hover",!0)}findView(t){let n=this.loadedViews.find(i=>i.alias===t);if(!n){let i=R(this.context).filter(o=>!!o.bladePath).find(o=>o.alias===t);return i&&this.loadedViews.push(i),i}return n}};function Ve(e){let t={scheme:"file",language:"blade"},n={scheme:"file",language:"php",pattern:"**/*.blade.php"},i={scheme:"file",language:"php"},o=new N(e),r=new _(e),s=new W(e);e.subscriptions.push(f.languages.registerCompletionItemProvider([t,n],o,"<"),f.languages.registerDocumentLinkProvider([t,n],o),f.languages.registerHoverProvider([t,n],o),f.languages.registerCompletionItemProvider([t,i],r,"'",'"'),f.languages.registerDocumentLinkProvider([t,i],r),f.commands.registerTextEditorCommand("livewire-jump.refreshViews",a=>{ge(e,a)}),f.commands.registerCommand("livewire-jump.goToClass",()=>{Y(e)}),f.commands.registerCommand("livewire-jump.goToView",()=>{Y(e)}),f.commands.registerCommand("livewire-jump.clearViews",async()=>{await he(e)}),f.languages.registerCompletionItemProvider([t,n],s,"<"),f.languages.registerDocumentLinkProvider([t,n],s),f.commands.registerCommand("livewire-jump.refreshBladeIcons",async()=>{await ae(e)}),f.commands.registerCommand("livewire-jump.clearBladeIcons",async()=>{await se(e)}),f.window.onDidChangeActiveTextEditor(a=>{U(e,a)}),f.workspace.onDidChangeConfiguration(a=>{a.affectsConfiguration("livewire-jump.view.navigation")&&(m("view.navigation",!0)?U(e,void 0):A())})),U(e,f.window.activeTextEditor),console.log("Livewire Jump up")}function De(){}0&&(module.exports={activate,deactivate});
