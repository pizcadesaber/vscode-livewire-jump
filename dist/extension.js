"use strict";var Y=Object.defineProperty;var Be=Object.getOwnPropertyDescriptor;var De=Object.getOwnPropertyNames;var Se=Object.prototype.hasOwnProperty;var Fe=(e,t)=>{for(var n in t)Y(e,n,{get:t[n],enumerable:!0})},Re=(e,t,n,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of De(t))!Se.call(e,o)&&o!==n&&Y(e,o,{get:()=>t[o],enumerable:!(i=Be(t,o))||i.enumerable});return e};var Ue=e=>Re(Y({},"__esModule",{value:!0}),e);var Me={};Fe(Me,{activate:()=>Ke,deactivate:()=>He});module.exports=Ue(Me);var f=require("vscode");var k=require("vscode");var G=require("path"),g=require("vscode");var le=require("path"),x=require("vscode"),X=0;function W(){X=performance.now()}function Le(){return X!==0?Math.round(performance.now()-X):0}function z(e=!1){let t=Le();return t=t>1e3?(t/1e3).toFixed(2)+" s":t+" ms",e?`(${t})`:`${t}`}function y(...e){if(!x.workspace.workspaceFolders)return;let t=x.workspace.workspaceFolders[0].uri;return e?x.Uri.file((0,le.join)(t.path,...e.filter(n=>!!n))):t}function ee(e,t){let n=e.indexOf(t),i=n>0;return i&&(e.splice(n,1),e.unshift(t)),i}async function pe(e){return new TextDecoder("utf-8").decode(await x.workspace.fs.readFile(e))}function te(e){e?x.workspace.openTextDocument(e).then(t=>{x.window.showTextDocument(t)},()=>{x.window.showInformationMessage("File not found: "+e?.fsPath)}):x.window.showInformationMessage("File Not found.")}function m(e,t){let n=x.workspace.getConfiguration("livewire-jump");return e?t?n.get(e,t):n.get(e):n}function A(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").replace("_","-").toLowerCase()}function F(e,t){return`${e.extension.id}.${t}`}async function ce(e){let t=`${e.extension.id}.`,n=e.workspaceState.keys().filter(i=>i.startsWith(t));for(let i of n)await e.workspaceState.update(i,void 0);x.window.showInformationMessage("All indexed elements have been cleared. You need to reload the extension to reset the elements in memory.","Reload").then(i=>{i==="Reload"&&x.commands.executeCommand("workbench.action.reloadWindow")})}var B,ne=0,de=[];async function ie(e){let t=m("blade.icon.dirs",{});if(t){W(),B=[],ne=0,de=Object.entries(t).filter(([n,i])=>!!n).map(([n,i])=>Ae(n,i));for(let n of de)if(n.group){let i=y(n.path);if(i){let o=await we(n.group,i);o&&B.push(o)}}await e.workspaceState.update(oe(e),B),g.window.showInformationMessage("Icons Refreshed: "+ne+" icons "+z(!0))}}function ue(e){if(B===void 0)try{B=e.workspaceState.get(oe(e),[])}catch{return g.window.showInformationMessage("Upgrading icons..."),ie(e),[]}return B}async function fe(e){B=[],await e.workspaceState.update(oe(e),void 0),g.window.showInformationMessage("Icons Cleared")}function me(e,t){return ge(ue(e),[],"",t)}function ge(e,t,n,i){let o=[];return e.forEach(r=>{o.push(...ge(r.groups,r.icons,n+r.tag,i))}),t.forEach(r=>{let s=n+r.tag,a=new g.CompletionItem(s,g.CompletionItemKind.Snippet);a.detail="Blade Icon",a.insertText=new g.SnippetString(`${s} $0`),a.documentation=new g.MarkdownString(`Inserts a blade icon: 

\`\`\`html
<${s} />
\`\`\``),a.range=i,o.push(a)}),o}function he(e,t){let n=ue(e);if(n.length===0)return;let i=y();return i?xe(n,[],i,t):void 0}function xe(e,t,n,i){for(let o of e)if(i.startsWith(o.tag))return xe(o.groups,o.icons,n.with({path:(0,G.join)(n.path,o.path)}),i.substring(o.tag.length));for(let o of t)if(o.tag===i)return{...o,uri:n.with({path:(0,G.join)(n.path,o.name)})}}function oe(e){return F(e,"blade.icons")}function Ae(e,t){return{path:e,tag:t,group:e&&t?{path:e,tag:t,groups:[],icons:[]}:void 0}}async function we(e,t){let n=[];try{n=await g.workspace.fs.readDirectory(t)}catch{return}for(let[i,o]of n)if(o===g.FileType.Directory){let r=await we({path:i,tag:A(i)+".",groups:[],icons:[]},t.with({path:(0,G.join)(t.path,i)}));r&&e.groups.push(r)}else o===g.FileType.File&&i.endsWith(".svg")&&(ne+=1,e.icons.push({name:i,tag:A(i.replace(/\.svg$/,""))}));return e.groups.length>0||e.icons.length>0?e:void 0}var N=class{constructor(t){this.context=t}linkedIcons=[];getLinkRE(){return/<\/?(x-[a-z0-9][a-z0-9-\.:]*)[\s\/>$]/g}provideCompletionItems(t,n){if(!m("blade.icon.completion",!0))return[];let o=t.lineAt(n).text.slice(0,n.character).match(/<([a-z0-9-\.:]*)$/i);if(!o)return[];let r=new k.Range(new k.Position(n.line,o.index+1),new k.Position(n.line,n.character));return me(this.context,r)}provideDocumentLinks(t,n){if(!m("blade.icon.link",!0))return[];this.linkedIcons=[];let i=[],o=100;for(let r=0;r<t.lineCount;r++){if(n.isCancellationRequested)return[];let s=t.lineAt(r),a=this.getLinkRE(),l,u=0;for(;(l=a.exec(s.text))!==null&&u<o;){if(n.isCancellationRequested)return[];if(u++,l){let c=l[1],p=this.linkedIcons.find(J=>J.tag===c);if(!p){if(p=he(this.context,c),!p)continue;this.linkedIcons.push(p)}if(!p.uri)continue;let I=l[0],V=l.index+I.indexOf(c),S=new k.Position(s.lineNumber,V),L=new k.Position(s.lineNumber,V+c.length);i.push(new k.DocumentLink(new k.Range(S,L),p.uri)),a.lastIndex===l.index&&a.lastIndex++}}}return i}};var d=require("vscode");var D=require("path"),w=require("vscode");var Ce=require("path"),v=require("vscode");var C,$,E=[];function re(e){E.length===1?te(E[0].uri):E.length>1&&v.window.showQuickPick(E,{placeHolder:"Choose an option"}).then(t=>{t?.uri&&($==="php"?(C=C,ee(C.aliases,t.label)&&be(e)):$==="blade"&&(C=C,ee(C.phpReferences,t.label)&&ve(e)),te(t.uri))})}function j(){C=void 0,$=void 0,E=[],v.commands.executeCommand("setContext","livewire-jump.hasView",!1),v.commands.executeCommand("setContext","livewire-jump.hasClass",!1)}function U(e,t){if(!m("view.navigation",!0)||(j(),!t))return;let n=v.workspace.asRelativePath(t.document.uri.path,!1);t.document.languageId==="blade"||t.document.uri.path.endsWith(".blade.php")?(C=R(e).find(i=>i.bladePath===n),C?.phpReferences&&C.phpReferences.length>0&&($="blade",C.phpReferences.forEach(i=>{let o=y(i);o&&E.push({label:i,description:"PHP",uri:o})})),E.length>0&&v.commands.executeCommand("setContext","livewire-jump.hasClass",!0)):(t.document.languageId==="php"||t.document.uri.path.endsWith(".php"))&&(C=Te(e).find(i=>i.path===n),$="php",C?.aliases.forEach(i=>{let o=R(e).find(r=>r.alias===i);if(o){let r=y(o.bladePath);r&&E.push({label:i,description:"View",uri:r})}}),E.length>0&&v.commands.executeCommand("setContext","livewire-jump.hasView",!0))}function ae(e,t){let n=v.workspace.getWorkspaceFolder(t);if(!n)return;let i;if(e.bladePath)i=e.bladePath;else if(e.phpPath)i=e.phpPath;else return;return v.Uri.file((0,Ce.join)(n.uri.path,i))}function Pe(e,t,n){let i=K(e).find(o=>o.tag===t);return i?ae(i,n):void 0}async function Ie(e){if(!e)return[];let t=/\bview\s*\(\s*[\'"]([a-z0-9\.-]+)[\'"]/g,n=[],i=t.exec(e);for(;i;){let o=i[1];n.includes(o)||n.push(i[1]),i=t.exec(e)}return n}var M=[],P,h,b,H=[];function R(e){return P===void 0&&(P=e.workspaceState.get(O(e),[])),P}function ve(e){e.workspaceState.update(O(e),P)}function be(e){e.workspaceState.update(_(e),b)}function K(e){return h===void 0&&(h=e.workspaceState.get(se(e),[])),h}function Te(e){return b===void 0&&(b=e.workspaceState.get(_(e),[])),b}async function ye(e,t){let n=m("view.dirs",{});if(!n)return;W(),M=Object.entries(n).map(([o,r])=>$e(o,r)),P=[],h=[],b=[];let i=w.workspace.getWorkspaceFolder(t.document.uri);if(i){H=[];for(let o of M)await Ve(o,"",i.uri);for(let o of M)await Ee(o,"",i.uri),P!==void 0&&b.forEach(r=>{r.aliases=r.aliases.filter(s=>{let a=!1;return P?.forEach(l=>{l.alias===s&&(l.phpReferences.includes(r.path)||l.phpReferences.push(r.path),a=!0)}),a})}),h!==void 0&&h.forEach(r=>{P?.some(s=>s.alias===r.alias?(r.bladePath=s.bladePath,!0):!1)});if(h===void 0)H=[];else for(;H.length>0;){let o=H.pop();o&&!h.some(r=>r.alias===o.alias)&&h.push(o)}}await e.workspaceState.update(O(e),P),await e.workspaceState.update(se(e),h),await e.workspaceState.update(_(e),b),w.window.showInformationMessage(`Refreshed Views: ${P.length} views, ${h.length} components, ${b.length} classes `+z(!0)),U(e,t)}async function ke(e){P=[],h=[],b=[],await e.workspaceState.update(O(e),void 0),await e.workspaceState.update(se(e),void 0),await e.workspaceState.update(_(e),void 0),j(),w.window.showInformationMessage("Cleared Views")}function $e(e,t){let n=e.split(/\||:|\s/g),i=t.split(/\||\s/g),o=i[1],r;return o?.startsWith("x-")?r=1:o?.startsWith("livewire:")?r=2:o&&(r=3),{bladePath:n[0],phpPath:n[1],alias:i[0]??"",tag:o,componentType:r}}function O(e){return F(e,"views")}function se(e){return F(e,"components")}function _(e){return F(e,"phpFiles")}async function Ee(e,t,n){if(b===void 0&&h===void 0||!e.phpPath)return;let i=[];try{i=await w.workspace.fs.readDirectory(n.with({path:(0,D.join)(n.path,e.phpPath,t)}))}catch{return}for(let[o,r]of i){let s=(0,D.join)(t,o),a=(0,D.join)(e.phpPath,s);if(r===w.FileType.Directory&&!M.some(l=>a===l.phpPath))await Ee(e,s,n);else if(r===w.FileType.File&&o.endsWith(".php")){let l=y(a),u=A(s.replace(/\//g,".").replace(/\.php$/,"")),c=l?await Ie(await pe(l)):[];if(c.length===0&&c.push(e.alias+u),b!==void 0){let p={aliases:c,path:a};b.push(p)}if(h!==void 0&&e.componentType&&e.tag){let p={phpPath:a,tag:e.tag+je(u),alias:c[0],type:e.componentType};h.push(p)}}}}function je(e){let t=e.split(".");if(t.length<2)return e;let n=t.pop(),i=t.join(".");return t[t.length-1]===n?i:e}async function Ve(e,t,n){if(P===void 0||!e.bladePath)return;let i=[];try{i=await w.workspace.fs.readDirectory(n.with({path:(0,D.join)(n.path,e.bladePath,t)}))}catch{return}let o=!1,r="";if(e.componentType===1&&(o=!t,!o&&(o=i.some(([s,a])=>a===w.FileType.File&&s==="index.blade.php"),i=i.filter(([s])=>s!=="index.blade.php"),!o))){let a=t.split("/").pop();a&&(a+=".blade.php",o=i.some(([l,u])=>u===w.FileType.File&&l===a),r=a)}for(let[s,a]of i){let l=(0,D.join)(t,s),u=(0,D.join)(e.bladePath,l);if(a===w.FileType.Directory&&!M.some(c=>u===c.bladePath))Ve(e,l,n);else if(a===w.FileType.File&&s.endsWith(".blade.php")){let c=l.replace(/\//g,".").replace(/\.blade\.php$/,""),p=e.alias+c,I={bladePath:u,alias:p,phpReferences:[]};if(P.push(I),o&&h!==void 0&&e.componentType&&e.tag){let V={bladePath:u,tag:e.tag+(s===r?c.substring(0,c.length-r.length+9):c),alias:p,type:e.componentType};H.push(V)}}}}var q=class{constructor(t){this.context=t}linkedComponents=[];getLinkRE(){return/<\/?([a-z0-9][a-z0-9-\.:]{3,}[a-z0-9])[\s\/>$]/g}provideCompletionItems(t,n){if(!m("blade.tag.completion",!0))return[];this.linkedComponents=[];let o=t.lineAt(n).text.slice(0,n.character).match(/<([a-z0-9-\.:]*)$/);return o?K(this.context).map(s=>{let a=new d.CompletionItem(s.tag,d.CompletionItemKind.Snippet);return a.detail="Component",a.insertText=new d.SnippetString(`${s.tag} $0`),a.documentation=new d.MarkdownString(`Inserts a component: 

\`\`\`html
<${s.tag} />
\`\`\``),o.index&&(a.range=new d.Range(new d.Position(n.line,o.index+1),new d.Position(n.line,n.character))),a}):[]}provideDocumentLinks(t,n){if(!m("blade.tag.link",!0))return[];let i=[],o=100;for(let r=0;r<t.lineCount;r++){let s=t.lineAt(r),a=this.getLinkRE(),l,u=0;for(;(l=a.exec(s.text))!==null&&u<o;){if(n.isCancellationRequested)return[];if(u++,l){let c=l[1],p=this.linkedComponents.find(Q=>Q.tag===c);if(a.lastIndex===l.index&&a.lastIndex++,!p){if(p=K(this.context).find(Q=>Q.tag===c),!p)continue;this.linkedComponents.push(p)}let I=ae(p,t.uri);if(!I)continue;let V=l[0],S=l.index+V.indexOf(c),L=new d.Position(s.lineNumber,S),J=new d.Position(s.lineNumber,S+c.length);i.push(new d.DocumentLink(new d.Range(L,J),I))}}}return i}provideHover(t,n,i){if(!m("blade.tag.hover",!0))return null;let o=t.lineAt(n.line).text,r,s=this.getLinkRE();for(;(r=s.exec(o))!==null;){if(i.isCancellationRequested)return null;let a=r[1],l=r.index,u=l+a.length;if(n.character>=l&&n.character<=u){let c=new d.Range(new d.Position(n.line,l),new d.Position(n.line,u)),p=Pe(this.context,a,t.uri);if(!p)continue;if(p){let I=d.workspace.asRelativePath(p.fsPath);return new d.Hover(`Component: **${a}**

Path: ${I}`,c)}}}return null}};var T=require("vscode");var Z=class e{constructor(t){this.context=t}linkedViews=[];static regex="(?:"+["(?:"+["#\\[Layout","@(?:"+["each","extends","include","includeIf"].join("|")+")","(?:^|[^A-Za-z0-9_:])(?:"+["view","links","layout","withView"].join("|")+")"].join("|")+`)\\(['"]([a-zA-Z0-9\\.-:]*)`].join("|")+")";provideCompletionItems(t,n,i,o){if(m("view.completion",!0)===!1)return[];let r=t.lineAt(n).text,s=RegExp(e.regex+"$").exec(r.slice(0,n.character));if(!s)return[];let a=new T.Position(n.line,s.index+s[0].length-s[1].length),l=new T.Position(n.line,s.index+s[0].length),u=new T.Range(a,l);return(R(this.context)||[]).map(c=>{let p=new T.CompletionItem(`${c.alias}`,T.CompletionItemKind.File);return p.detail="Blade View",p.documentation=`View: ${c.alias}`,p.range=u,p})}provideDocumentLinks(t,n){if(!m("view.link",!0))return[];this.linkedViews=[];let i=[],o=t.getText(),r=100,s=0,a,l=RegExp(e.regex+`['"]`,"g");for(;(a=l.exec(o))!==null&&s<r;){if(n.isCancellationRequested)return[];let u=a[1];if(u){let c=this.findView(u),p=c?y(c.bladePath):void 0;if(p){let I=a.index+a[0].indexOf(u),V=I+u.length,S=t.positionAt(I),L=t.positionAt(V);i.push(new T.DocumentLink(new T.Range(S,L),p))}l.lastIndex===a.index&&l.lastIndex++}s++}return i}provideHover(t,n,i){m("view.hover",!0)}findView(t){let n=this.linkedViews.find(i=>i.alias===t);if(!n){let i=R(this.context).filter(o=>!!o.bladePath).find(o=>o.alias===t);return i&&this.linkedViews.push(i),i}return n}};function Ke(e){let t={scheme:"file",language:"blade"},n={scheme:"file",language:"php",pattern:"**/*.blade.php"},i={scheme:"file",language:"php"},o=new q(e),r=new Z(e),s=new N(e);e.subscriptions.push(f.commands.registerCommand("livewire-jump.clearIndexedItems",async()=>{await ce(e)}),f.languages.registerCompletionItemProvider([t,n],o,"<"),f.languages.registerDocumentLinkProvider([t,n],o),f.languages.registerHoverProvider([t,n],o),f.languages.registerCompletionItemProvider([t,i],r,"'",'"'),f.languages.registerDocumentLinkProvider([t,i],r),f.commands.registerTextEditorCommand("livewire-jump.refreshViews",a=>{ye(e,a)}),f.commands.registerCommand("livewire-jump.goToClass",()=>{re(e)}),f.commands.registerCommand("livewire-jump.goToView",()=>{re(e)}),f.commands.registerCommand("livewire-jump.clearViews",async()=>{await ke(e)}),f.languages.registerCompletionItemProvider([t,n],s,"<"),f.languages.registerDocumentLinkProvider([t,n],s),f.commands.registerCommand("livewire-jump.refreshBladeIcons",async()=>{await ie(e)}),f.commands.registerCommand("livewire-jump.clearBladeIcons",async()=>{await fe(e)}),f.window.onDidChangeActiveTextEditor(a=>{U(e,a)}),f.workspace.onDidChangeConfiguration(a=>{a.affectsConfiguration("livewire-jump.view.navigation")&&(m("view.navigation",!0)?U(e,void 0):j())})),U(e,f.window.activeTextEditor),console.log("Livewire Jump up")}function He(){}0&&(module.exports={activate,deactivate});
